VOD DAI Ad Viewership Summary Report
======================================




=========================
===Data Source Mapping===
=========================

Input or Field 		Data Source
---------------		--------------------------------------------------------------------------------------------
Ad Title Brief 		PlacementResponse.PlacementDecision.Placement.Content.AssetRef@providerID and @assetID
					mapped to the asset database to pull AD TITLE field
					
Ad-ID 				PlacementResponse.PlacementDecision.Placement.Content.AssetRef@providerID and @assetID
					mapped to the asset database to pull Ad-ID field
					
Ad Asset ID 		PlacementResponse.PlacementDecision.Placement.Content.AssetRef@assetID

Scheduled			Occurance of PlacementResponse.PlacementDecision.Placement.Content.AssetRef@providerID and @assetID
Insertions

--++++++++++++++++++++++++++++++
Programmer			PlacementRequest.Entertainment.ProviderID mapped to the network and then programmer
					in the cm/asset database

Network 			PlacementRequest.Entertainment.ProviderID mapped to the network in the cm/asset database
					provider.id
					provider_network.provider_id

MSO 				PlacementRequest@identity mapped to MSO in cm/asset database

ServiceGroup 		For TWC,    PlacementRequest.ADMData

--++++++++++++++++++++++++++++++					
Views 				PlacementStatusNotification.PlayData.SpotScopedEvents.Events.PlacementStatusEvent or
					[PlacementStatusNotificationVODDAI-51].PlayData.Events.PlacementStatusEvent
					where	PlacementStatusEvent@type = "startPlacement"
					  and	PlacementStatusEvent.SpotNPT@scale = 1
					  and 	PlacementStatusEvent.SpotNPT@value = 0
					  
Views/HH			Views / Unique HHs

Unique HHs			Count of the unique occurances of PlacementRequest.Client.TargetCode where a view was recorded


-----------------------------------------------------------------------------------------------------------
select distinct
  NT.PROGRAMMER_ID,  P.name PROG_NAME, 
  NT.id NTWK_ID,    NT.name NTWK_NAME, 
  PROV.PROVIDER_ID
from PROGRAMMER P, network NT, PROVIDER_NETWORK prov
where NT.PROGRAMMER_ID = P.id
--  and P.id in (1, 72, 73, 74, 75) 
  and nt.id in (1, 72, 73, 74, 75) 
  and prov.network_id = nt.id
order by 1, 3




Aggregation Table, round 1:
===========================
select
   srp.session_id,
   op.company_name OPERATOR,
   substr(srp.tracking_id,1,instr(srp.tracking_id,'-',1)-1) CAMPAIGN_ID,
--   substr(srp.tracking_id,  instr(srp.tracking_id,'-', 1)+1,instr(srp.tracking_id,'-',2)-1) CAMPAIGN_ITEM_ID,
   req.adm_data as SERVICE_GROUP, ma.id as media_asset_id,
   to_date(substr(req.CLIENT_DT_STRING,1,13),'YYYY-MM-DD"T"HH24') DATE_HOUR,
   count(srp.placement_id) insert_count
 from SCTE_RESPONSE_PLACEMENT srp, SCTE_RESPONSE res, SCTE_REQUEST req,
      dai_reporting.OPERATOR op, dai_reporting.VOD_ENDPOINT endpt, dai_reporting.MEDIA_ASSET ma
 where res.message_id    = srp.response_message_id
   and REQ.MESSAGE_ID    = RES.REQUEST_MESSAGE_ID
   and op.id             = endpt.operator_id 
   and endpt.id          = req.identity_vod_endpt_id
   and ma.provider_id    = srp.tracking_provider_id
   and ma.asset_idstring = srp.tracking_asset_id

   
   
   
   
development work, 05/21/2012
=============================

----> logged into dai_reporting:
select * from provider order by ID   --- 'MystroTV'

select *
from PROVIDER_NETWORK
where PROVIDER_ID = 'MystroTV'
order by 2              


PROVIDER_ID is 'MystroTV'
network IDS ARE:  1, 72, 73, 74, 75


select *
from network
where PROGRAMMER_ID in (1, 72, 73, 74, 75) 
--  and programmer_id in (select id from programmer)
order by id, name
---ID, PROGRAMMER_ID, NAME




select * from PROGRAMMER
where id in (1, 72, 73, 74, 75) 
---ID, NAME, SHORT_NAME


select distinct
  P.id PROG_ID, P.name PROG_NAME, P.SHORT_NAME PROG_SHORT_NAME,
  NT.id NTWK_ID, NT.PROGRAMMER_ID, NT.name NTWK_NAME
from PROGRAMMER P, network NT
where NT.PROGRAMMER_ID = P.id
  and P.id in (1, 72, 73, 74, 75) 
order by 1, 4  



select distinct
  NT.PROGRAMMER_ID,  P.name PROG_NAME, 
  NT.id NTWK_ID,    NT.name NTWK_NAME, 
  PROV.PROVIDER_ID
from PROGRAMMER P, network NT, PROVIDER_NETWORK prov
where NT.PROGRAMMER_ID = P.id
--  and P.id in (1, 72, 73, 74, 75) 
  and nt.id in (1, 72, 73, 74, 75) 
  and prov.network_id = nt.id
order by 1, 3
---  P.id PROG_ID, P.SHORT_NAME PROG_SHORT_NAME, PROV.NETWORK_ID,


select * from PROVIDER_NETWORK

select *   from DAI_REPORTING.MEDIA_ASSET
select *   from DAI_REPORTING.MEDIA_ASSET_VIEW

  
select unique ASSET_IDSTRING, PROVIDER_ID
from DAI_REPORTING.MEDIA_ASSET
where ASSET_IDSTRING in (select TRACKING_ASSET_ID from DAI_REPORTING_ODS.SCTE_RESPONSE_PLACEMENT)
order by provider_id, asset_idstring   ----> 120 rows with NO sub-query; 21 rows WITH


select distinct AD_ID, ADVERTISER, ADVERTISER_ID from DAI_REPORTING.MEDIA_ASSET_VIEW




select * from dai_reporting.MEDIA_ASSET    ---> 84
where ASSET_IDSTRING in 
   (select tracking_asset_id from dai_reporting_ods.SCTE_RESPONSE_PLACEMENT)








select
 object_type, object_name, created, timestamp, status
from user_objects
where object_type in ('TABLE')
  and object_name like 'SCTE%'
order by 1, 2
/*
SCTE_PSN
SCTE_REQUEST
SCTE_REQUEST_OPPORTUNITY
SCTE_RESPONSE
SCTE_RESPONSE_PLACEMENT
*/



select * from SCTE_PSN
select * from SCTE_RESPONSE
select * from SCTE_RESPONSE_PLACEMENT
select * from SCTE_REQUEST
select * from SCTE_REQUEST_OPPORTUNITY


select
 req.message_id, req.session_id, req.adm_data, req.identity_vod_endpt_id, req.terminal_addr, req.entertainment_provider_id
from SCTE_REQUEST req
 
 
select count(*) from
( 
select
  srp.response_message_id, srp.tracking_asset_id, srp.placement_id, srp.tracking_provider_id,
  srp.placement_action, srp.placement_pos, srp.session_id
from  SCTE_RESPONSE_PLACEMENT srp 
)

select unique 'xx'||tracking_provider_id||'xx' from 
(
select
  srp.response_message_id, srp.tracking_asset_id, srp.placement_id, srp.tracking_provider_id,
  srp.placement_action, srp.placement_pos, srp.session_id
from  SCTE_RESPONSE_PLACEMENT srp 
)






select count(*) from 
(
select
  srp.response_message_id, srp.tracking_asset_id, srp.placement_id, pnet.provider_id,
  srp.placement_action, srp.placement_pos, srp.session_id,
  net.name, net.programmer_id, prog.name
from
  SCTE_RESPONSE_PLACEMENT srp, dai_reporting.PROVIDER_NETWORK pnet,
  dai_reporting.NETWORK net, dai_reporting.PROGRAMMER prog
where srp.tracking_provider_id = pnet.provider_id
  and pnet.network_id = net.ID
  and net.id = prog.id
  and prog.id = 1
) 



  

 
 
 

SCTE_REQUEST
  message_id,
  session_id,
  adm_data,
  identity_vod_endpt_id,
  terminal_addr,
  entertainment_provider_id
  


SCTE_RESPONSE
  request_message_id,
  message_id,
  session_id


   
   
   
   
   
select
 res_p.session_id, res_p.placement_id, res_p.tracking_provider_id, res_p.tracking_asset_id,
 req.CLIENT_DT_STRING RAW_DATE, req.CLIENT_DT_STRING RAW_TIME, req.CLIENT_DT_STRING RAW_TZ,
 req_p.opportunity_type, req_p.opportunity_number, res_p.placement_pos
from SCTE_REQUEST req, SCTE_REQUEST_OPPORTUNITY req_p, SCTE_RESPONSE res, SCTE_RESPONSE_PLACEMENT res_p
where req.MESSAGE_ID = req_p.REQUEST_MESSAGE_ID
  and req.MESSAGE_ID = res.REQUEST_MESSAGE_ID
  and res.MESSAGE_ID = res_p.RESPONSE_MESSAGE_ID
order by 1  



select unique 
   req.CLIENT_DT_STRING
 ,  to_date(substr(req.CLIENT_DT_STRING,1,13),'YYYY-MM-DD"T"HH24') DATE_HOUR
 ,  to_timestamp(substr(req.CLIENT_DT_STRING,1,23),'YYYY-MM-DD"T"HH24:MI:SS:FF') date_time_V1
 ,  to_timestamp_tz(req.CLIENT_DT_STRING,'YYYY-MM-DD"T"HH24:MI:SS:FF') date_time_V2
from SCTE_REQUEST req


create table ben_tz_test as
select unique 
   req.CLIENT_DT_STRING
  ,replace(req.CLIENT_DT_STRING,'T', ' ') CLIENT_DATE_TIME_FULL
  ,to_timestamp_tz(replace(req.CLIENT_DT_STRING,'T', ' '),'YYYY-MM-DD HH24:MI:SS:FF TZH:TZM') TZ_TEST_V1
--  ,sys_extract_utc(replace(req.CLIENT_DT_STRING,'T', ' '))
--  ,from_tz(replace(req.CLIENT_DT_STRING,'T', ' ')) TZ_TEST
--  ,from_tz(timestamp(replace(req.CLIENT_DT_STRING,'T', ' ')) TZ_TESTING
from SCTE_REQUEST req

describe ben_tz_test

drop table ben_tz_test purge

select
  client_date_time_full
 ,tz_test_v1
 ,substr(tz_test_v1,-4,4) offset_amt
-- ,extract(timezone_abbr from substr(tz_test_v1,-4,4))
-- ,extract(timezone_abbr from TZ_TEST_V!)
from ben_tz_test
   

SELECT * FROM gv$timezone_names;

select dbtimezone from dual
SELECT SYSTIMESTAMP AT TIME ZONE dbtimezone FROM DUAL;
select new_time('



---===================================================================
05/22/2012:

select
  srp.response_message_id, srp.session_id, srp.tracking_asset_id, srp.placement_id, srp.tracking_provider_id,
  srp.placement_action, srp.placement_pos, srp.session_id
from  SCTE_RESPONSE_PLACEMENT srp 


select
  srp.session_id, srp.placement_id, srp.tracking_provider_id,
  to_date(substr(req.CLIENT_DT_STRING,1,10),'YYYY-MM-DD') TXN_DATE,
  substr(req.CLIENT_DT_STRING,12,5)                       TXN_TIME,
  substr(req.CLIENT_DT_STRING,-6,6)                       TXN_TZ_OFFSET,
--  req.CLIENT_DT_STRING,
--  replace(req.CLIENT_DT_STRING,'T',' ') TXN_DATE,
  req.terminal_addr,
  oppty.opportunity_number, srp.placement_pos,
  req.entertainment_asset_id
from SCTE_REQUEST req, SCTE_REQUEST_OPPORTUNITY oppty, SCTE_RESPONSE rep, SCTE_RESPONSE_PLACEMENT srp
where srp.response_message_id  = rep.message_id
  and rep.request_message_id   = req.message_id
  and oppty.request_message_id = req.message_id

1-10
2012-03-16

11
T

12-16
10:10:47.949-04:00

select unique placement_action from SCTE_RESPONSE_PLACEMENT
select unique CLIENT_DT_STRING from SCTE_REQUEST
























